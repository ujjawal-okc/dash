name: Build and Deploy

on:
  issues:
    types:
      - opened
  pull_request:
    branches:
      - releases/**
    types:
      - opened
      - synchronize

jobs:
  setup-build-publish-deploy:
    name: Setup, Build, Publish, and Deploy
    runs-on: ubuntu-18.04
      
    steps:
    - name: Environment
      if: startsWith(github.event.issue.title, 'deploy')
      run: echo "::set-env name=GIT_BRANCH::$(echo ${{ github.event.issue.title }} | sed 's/^deploy //I')"

    - name: Checkout
      uses: actions/checkout@v2
      with:
        ref: ${{ env.GIT_BRANCH }}
        path: main
        
    - name: Checkout Ops
      uses: actions/checkout@v2
      with:
        repository: ${{ format('{0}-ops', github.repository) }}
        token: ${{ secrets.TOKEN }}
        path: ops

